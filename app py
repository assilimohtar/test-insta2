from flask import Flask, request, render_template_string
import instaloader

app = Flask(__name__)

HTML_PAGE = '''
<!DOCTYPE html>
<html>
<head>
    <title>تأكيد المتابعة</title>
</head>
<body>
    <h1>هل يتابع الشخص</h1>
    <form method="POST">
        اسم المستخدم الأول: <input type="text" name="user1" required><br><br>
        اسم المستخدم الثاني: <input type="text" name="user2" required><br><br>
        <button type="submit">تأكيد</button>
    </form>
    {% if result %}
        <h3>{{ result }}</h3>
    {% endif %}
</body>
</html>
'''

def check_following(target_username, potential_follower):
    L = instaloader.Instaloader()
    try:
        profile = instaloader.Profile.from_username(L.context, potential_follower)
        for follower in profile.get_followers():
            if follower.username == target_username:
                return True
        return False
    except Exception as e:
        print(e)
        return False

@app.route('/', methods=['GET', 'POST'])
def index():
    result = ''
    if request.method == 'POST':
        user1 = request.form['user1'].strip()
        user2 = request.form['user2'].strip()
        if check_following(user1, user2):
            result = f"نعم، {user2} يتابع {user1}."
        else:
            result = f"لا، {user2} لا يتابع {user1}."
    return render_template_string(HTML_PAGE, result=result)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
